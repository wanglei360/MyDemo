package com.myplayer.video_2;import android.app.Activity;import android.content.pm.ActivityInfo;import android.content.res.Configuration;import android.graphics.Point;import android.net.Uri;import android.os.Bundle;import android.os.Environment;import android.view.Display;import android.view.View;import android.view.Window;import android.view.WindowManager;import com.myplayer.R;import com.myplayer.video_2.view.MediaController;import com.myplayer.video_2.view.VideoView;import java.io.File;import java.util.List;/** * 从写onConfigurationChanged方法,空实现就行,在清单文件中配置 * android:configChanges="orientation|screenSize|keyboardHidden" * 横竖屏切换的时候,activity就不会从新启动绘制页面了 */public class VideoActivity extends Activity implements MediaController.VideoViewRotateListener {    private MediaController mMediaController;    private Configuration cf;    private VideoView mVideoView;    @Override    protected void onCreate(Bundle savedInstanceState) {        super.onCreate(savedInstanceState);        removeTitle();        setContentView(R.layout.player_layout);        cf = this.getResources().getConfiguration();        mVideoView = (VideoView) findViewById(R.id.video_view);        mMediaController = new MediaController(this, mVideoView, Uri.parse(newFileName("超体.mp4")));        mMediaController.setVideoViewRotateListener(this);    }    /**     * 去除显示信号那一条的标题栏     */    private void removeTitle() {        requestWindowFeature(Window.FEATURE_NO_TITLE);        getWindow().setFlags(WindowManager.LayoutParams.FLAG_FULLSCREEN, WindowManager.LayoutParams.FLAG_FULLSCREEN);    }    /**     * 屏幕旋转的按钮的点击监听     */    @Override    public void videoViewRotateButClickListener() {        int ori = cf.orientation;        if (ori == Configuration.ORIENTATION_LANDSCAPE)            setRequestedOrientation(ActivityInfo.SCREEN_ORIENTATION_PORTRAIT);        else            setRequestedOrientation(ActivityInfo.SCREEN_ORIENTATION_LANDSCAPE);    }    @Override    public void onWindowFocusChanged(boolean hasFocus) {        super.onWindowFocusChanged(hasFocus);        List<Float> videoSizes = mMediaController.getVideoSizes();        if (videoSizes.size() == 0) {            Point size = new Point();            Display defaultDisplay = getWindowManager().getDefaultDisplay();            defaultDisplay.getSize(size);            videoSizes.add((float) size.x);//屏幕的宽            videoSizes.add((float) size.y);//屏幕的高        }    }    /**     * 监听activity的横竖屏切换     */    @Override    public void onConfigurationChanged(Configuration newConfig) {        super.onConfigurationChanged(newConfig);        List<Float> videoSizes = mMediaController.getVideoSizes();        if (videoSizes.size() == 0)            return;        View view = mMediaController.getmView();        if (view == null)            return;        int ori = cf.orientation;        float width;        float height;        if (ori == Configuration.ORIENTATION_LANDSCAPE) {//横屏            width = videoSizes.get(1);            height = videoSizes.get(0);        } else {//竖屏            height = videoSizes.get(3);            width = videoSizes.get(2);        }        float x = width / 2 - 80 / 2;        float y = height / 2 - 80 / 2;        view.setX(x);        view.setY(y);    }    @Override    protected void onResume() {        super.onResume();        //todo 不加这一个,有的时候这个页面从新获取焦点的时候,开始的按钮的坐标就都贵0了        setRequestedOrientation(ActivityInfo.SCREEN_ORIENTATION_PORTRAIT);    }    @Override    protected void onPause() {        super.onPause();        if (mVideoView != null && mVideoView.isPlaying()) {            mVideoView.pause();        }    }    @Override    protected void onDestroy() {        super.onDestroy();        if (mMediaController != null) {            mMediaController.onDestroy();        }    }    private String newFileName(String str) {        String folder;        if (Environment.getExternalStorageState().equals(// 如果sd卡挂载了                android.os.Environment.MEDIA_MOUNTED)) {            folder = Environment.getExternalStorageDirectory()// 存SD卡上                    + File.separator;        } else {            folder = Environment.getRootDirectory() + File.separator;// 否则存机器上        }        File file = new File(folder);        if (!file.exists()) {            file.mkdirs();        }        return folder + "wanglei/" + str;//123    }}